\NeedsTeXFormat{LaTeX2e}[2022-06-01]
\ProvidesPackage{cronologicug}[2024-07-30]
\author{cronologic GmbH \& Co KG}

\RequirePackage{iftex}
\ifLuaTeX 
  \directlua{pdf.setminorversion(7)}
\fi
\ifxetex
  \special{pdf:minorversion 7}
\fi

\DeclareKeys{
  font.store              = \@crono@font,
  sphinx.if               = @crono@sphinx,
  noframe.if              = @crono@noframe,
  monofontdescriptions.if = @crono@monofontdescriptions,
  pdfsubject.store  = \@crono@subject,
  pdfkeywords.store = \@crono@keywords,
  pdflang.store     = \@crono@language,
  left.store   = \@crono@left,
  right.store  = \@crono@right,
  top.store    = \@crono@top,
  bottom.store = \@crono@bottom,
  framemargin.store    = \@crono@framemargin,
  frameoffset.store    = \@crono@frameoffset,
  framelinesep.store   = \@crono@framelinesep,
  framelinewidth.store = \@crono@framelinewidth,
  headsep.store = \@crono@headsep,
  footskip.store = \@crono@footskip,
}

\SetKeys{
  font    = montserrat,
  noframe = false,
  pdflang = en,
  left    = 1.5cm,
  right   = 1.5cm,
  top     = 1.5cm,
  bottom  = 1.5cm,
  framemargin    = 1.25cm,
  frameoffset    = 0.8cm,
  framelinesep   = 0.6pt,
  framelinewidth = 0.3pt,
  headsep        = 0.35cm,
  footskip       = 18pt,
}

\ProcessKeyOptions

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% colors
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\PassOptionsToPackage{dvipsnames}{xcolor}
\RequirePackage{xcolor}
\definecolor{cronogrey}{gray}{0.5}
\definecolor{cronolightgrey}{RGB}{221,221,221}
\definecolor{cronoverylightgrey}{RGB}{244,244,244}
\definecolor{cronoorange}{RGB}{237, 120, 0}
\definecolor{cronoblue}{RGB}{55, 110, 181}
\definecolor{cronoblack}{RGB}{0,0,0}
\definecolor{cronolightgreen}{RGB}{86,159,214}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% miscellaneous
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage{graphicx}
\RequirePackage{tabularx,xltabular}
\RequirePackage{siunitx}
\RequirePackage{fancyhdr}
\RequirePackage{ifthen}

\if@crono@monofontdescriptions
  \RequirePackage{enumitem} % customized list layouts
  \setlist[description]{
    font={\ttfamily\bfseries}
  }
\fi

\RequirePackage{polyglossia}
\RequirePackage{pdfpages} % include pdfs with, e.g.,
                          % \includepdf[pages={-}]{fname}
\setdefaultlanguage{english}
\RequirePackage{xpatch} % pretend and append to cmd using xpre/apptocmd
\RequirePackage{ragged2e} % provide RaggedRight, RaggedLeft
\RequirePackage{tikz} % double line border support
\RequirePackage{array} %for centered AND constant width columns
\RequirePackage{makecell}  % multi line table cells
\RequirePackage{incgraph} % to include the title page
\RequirePackage{attachfile2} 

\RequirePackage{listings}
\definecolor{lstgreen}{RGB}{0, 112, 33}
\definecolor{lstred}{RGB}{142, 33, 0}
\definecolor{lstblue}{RGB}{5, 40, 124}
\definecolor{lstndigo}{RGB}{63, 127, 142}
\lstset{
  language=[Visual]C++,
  backgroundcolor=\color{cronoverylightgrey},
  keywordstyle=\bfseries\ttfamily\color{lstred},
  identifierstyle={},
  commentstyle=\color{lstgreen},
  stringstyle=\color{lstgreen},
  showstringspaces=false,
  basicstyle=\ttfamily\small,
  numberstyle=\tiny,
  numbers=left,
  stepnumber=1,
  numbersep=10pt,
  tabsize=2,
  breaklines=true,
  prebreak = \raisebox{0ex}[0ex][0ex]{\ensuremath{\hookleftarrow}},
  breakatwhitespace=false,
  aboveskip={1.5\baselineskip},
  columns=fixed,
  upquote=true,
  extendedchars=true,
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Text setup
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage{microtype} % better textblock layout

\PassOptionsToPackage{section,subsection,subsubsection}{extraplaceins}
\RequirePackage{extraplaceins} %for binding figures to a (sub-)section

\RequirePackage{caption}[2004-07-16]
\DeclareCaptionFont{cronocaptionlabelfont}{\bfseries\color{cronogrey}}
\DeclareCaptionFont{cronocaptionfont}{\color{cronogrey}}
\captionsetup{
    format=hang,
    width=0.8\textwidth,
    labelsep=space,
    labelfont=cronocaptionlabelfont,
    textfont=cronocaptionfont,
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Font and text setup
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{fontspec}

\PassOptionsToPackage{unicode-math}{
    mathrm=sym,
    math-style=ISO,
    bold-style=upright
}
\RequirePackage{unicode-math}

\defaultfontfeatures{Scale=MatchLowercase}

% font option "montserrat"
% since Montserrat doesn't have a Mono/Math font, set up different fonts
% for that
\ifthenelse{\equal{\@crono@font}{montserrat}}
{
    \setmainfont[
        ItalicFont={Montserrat-Italic.otf},
        BoldFont={Montserrat-Bold.otf},
        BoldItalicFont={Montserrat-BoldItalic.otf},
        Numbers=Tabular,
    ]{Montserrat-Regular.otf}
    \setsansfont[
        ItalicFont={Montserrat-Italic.otf},
        Numbers=Tabular,
        BoldFont={Montserrat-Bold.otf},
        BoldItalicFont={Montserrat-BoldItalic.otf}
    ]{Montserrat-Regular.otf}

    \setmonofont[
      Scale=MatchLowercase,
      ItalicFont={SourceCodePro-RegularIt.otf},
      BoldFont={SourceCodePro-Bold.otf},
      BoldItalicFont={SourceCodePro-BoldIt.otf}
    ]{SourceCodePro-Regular.otf}

    \setmathfont[Scale=MatchUppercase]{Latin Modern Math}

    \setmathfont[range=up/{latin,Latin,num},Numbers=Tabular]{Montserrat-Regular.otf}
    \setmathfont[range=it/{latin,Latin},Numbers=Tabular]{Montserrat-Italic.otf}
    \setmathfont[range=bfup/{latin,Latin,num},Numbers=Tabular]{Montserrat-Bold}
    \setmathfont[range=bfit/{latin,Latin},Numbers=Tabular]{Montserrat-BoldItalic.otf}

    \setmathfont[range=up/{greek,Greek}]{KerkisSans.otf}
    \setmathfont[range=it/{greek,Greek}]{KerkisSans-Italic.otf}
    \setmathfont[range=bfup/{greek,Greek}]{KerkisSans-Bold.otf}
    \setmathfont[range=bfit/{greek,Greek}]{KerkisSans-BoldItalic.otf}

    \newfontfamily\cronoheaderfont[
        ItalicFont={Montserrat-Italic.otf},
        BoldFont={Montserrat-Bold.otf},
        BoldItalicFont={Montserrat-BoldItalic.otf}
    ]{Montserrat-Regular.otf}
}{\relax}

% Font option "fira"
% https://www.ctan.org/tex-archive/fonts/fira
% https://www.ctan.org/pkg/firamath
\ifthenelse{\equal{\@crono@font}{fira}}
{
    \setmainfont[
        ItalicFont={FiraSans-Italic.otf},
        BoldFont={FiraSans-Bold.otf},
        BoldItalicFont={FiraSans-BoldItalic.otf}
    ]{FiraSans-Regular.otf}

    \setsansfont[
        ItalicFont={FiraSans-Italic.otf},
        BoldFont={FiraSans-Bold.otf},
        BoldItalicFont={FiraSans-BoldItalic.otf}
    ]{FiraSans-Regular.otf}

    \setmonofont[
        ItalicFont={FiraMono-Oblique.otf},
        BoldFont={FiraMono-Bold.otf},
        BoldItalicFont={FiraMono-BoldOblique.otf}
    ]{FiraMono-Regular.otf}

    \newfontfamily\cronoheaderfont
    [
        ItalicFont={Montserrat-Italic.otf},
        BoldFont={Montserrat-Bold.otf},
        BoldItalicFont={Montserrat-BoldItalic.otf}
    ]
    {Montserrat-Regular.otf}

    \setmathfont{Fira Math}
}{\relax}

% font option "avenirnext"
% The fonts Avenir Next and AvantGarde must be installed on the System
\ifthenelse{\equal{\@crono@font}{avenirnext}}
{
    \setmainfont[Numbers=Tabular]{Avenir Next}
    \setsansfont[Numbers=Tabular]{Avenir Next}

    \setmonofont[
      Scale=MatchLowercase,
      ItalicFont={SourceCodePro-RegularIt.otf},
      BoldFont={SourceCodePro-Bold.otf},
      BoldItalicFont={SourceCodePro-BoldIt.otf}
    ]{SourceCodePro-Regular.otf}

    \setmathfont[Scale=MatchUppercase]{Latin Modern Math}
    % \setmathfont{TeX Gyre Termes Math}

    \setmathfont[
      Numbers=Tabular,
      range=up/{latin,Latin,num,greek,Greek}
    ]{Avenir Next}
    \setmathfont[
      Numbers=Tabular,
      range=it/{latin,Latin,greek,Greek}
    ]{Avenir Next Italic}
    \setmathfont[
      Numbers=Tabular,
      range=bfup/{latin,Latin,num,greek,Greek}
    ]{Avenir Next Demi Bold}
    \setmathfont[
      Numbers=Tabular,
      range=bfit/{latin,Latin,greek,Greek}
    ]{Avenir Next Demi Bold Italic}

    \newfontfamily\cronoheaderfont{Avgardm.ttf}
}{\relax}

\ifthenelse{\equal{\@crono@font}{default}}
{
    \newcommand\cronoheaderfont{}
}{\relax}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Definitions for the whole document 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 
\newcommand{\filesep}{\textbackslash\allowbreak}  % used in file pathes
\newcommand{\lb}{\linebreak}
\newcommand{\cronvar}[2]{\noindent\texttt{\textbf{\textcolor{cronogrey}{#1}~#2}}}%for variable declaration
\newcommand{\crondef}[1]{\noindent\texttt{\textcolor{cronogrey}{\#{}define} #1}}%for definitions
\newcommand{\tu}{\textunderscore}%shorter
\newcommand{\subscript}[1]{\ensuremath{_{\textrm{#1}}}}
\renewcommand{\arraystretch}{1.6} 
\parskip 8pt

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% formatting
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage{geometry}
\geometry{
  left=\@crono@left,
  right=\@crono@right,
  top=\@crono@top,
  bottom=\@crono@bottom,
  headsep=\@crono@headsep,
}
\setlength\footskip\@crono@footskip
\RequirePackage{layout}

% headings
\RequirePackage{titlesec}
\titleformat{\chapter}%
    {\cronoheaderfont\LARGE\bfseries\color{cronoorange}}%
    {\thechapter}{1em}{\thispagestyle{normal}}{}
\titlespacing*{\chapter}%
    {0ex}{0ex}{*2}

\titleformat{\section}%
    {\cronoheaderfont\Large\bfseries\color{cronoorange}}%
    {\thesection}{1em}{}{}

\titleformat{\subsection}%
    {\cronoheaderfont\large\bfseries\color{cronoblue}}%
    {\thesubsection}{1em}{}{}

\titleformat{\subsubsection}%
    {\cronoheaderfont\bfseries\itshape\color{cronoblue}}%
    {\thesubsubsection}{1em}{}{}
    
% draw frame around text
\unless\if@crono@noframe
  \usetikzlibrary{calc}
  \AddToHook{shipout/background}{
    \ifnum\value{page}>1%
      \begin{tikzpicture}[remember picture,overlay]%
      % left lines
      \draw [line width=\@crono@framelinewidth,cronolightgrey] 
      ($(current page.north west)+(\@crono@framemargin,-\@crono@frameoffset)$)
      -- ($(current page.south west)+(\@crono@framemargin,\@crono@frameoffset)$);
      \draw [line width=\@crono@framelinewidth,cronolightgrey] 
      ($(current page.north west)+
        (\@crono@framemargin+\@crono@framelinesep,-\@crono@frameoffset)$)
      -- 
      ($(current page.south west)+
        (\@crono@framemargin+\@crono@framelinesep,\@crono@frameoffset)$);
      % right lines
      \draw [line width=\@crono@framelinewidth,cronolightgrey] 
      ($(current page.north east)+(-\@crono@framemargin,-\@crono@frameoffset)$)
      -- ($(current page.south east)+(-\@crono@framemargin,\@crono@frameoffset)$);
      \draw [line width=\@crono@framelinewidth,cronolightgrey] 
      ($(current page.north east)+
        (-\@crono@framemargin-\@crono@framelinesep,-\@crono@frameoffset)$)
      -- 
      ($(current page.south east)+
        (-\@crono@framemargin-\@crono@framelinesep,\@crono@frameoffset)$);
      % top lines
      \draw [line width=\@crono@framelinewidth,cronolightgrey] 
      ($(current page.north west)+(\@crono@frameoffset,-\@crono@framemargin)$)
      -- ($(current page.north east)+(-\@crono@frameoffset,-\@crono@framemargin)$);
      \draw [line width=\@crono@framelinewidth,cronolightgrey] 
      ($(current page.north west)+
        (\@crono@frameoffset,-\@crono@framemargin-\@crono@framelinesep)$)
      -- 
      ($(current page.north east)+
        (-\@crono@frameoffset,-\@crono@framemargin-\@crono@framelinesep)$);
      % bottom lines
      \draw [line width=\@crono@framelinewidth,cronolightgrey]
      ($(current page.south west)+(\@crono@frameoffset,\@crono@framemargin)$)
      -- ($(current page.south east)+(-\@crono@frameoffset,\@crono@framemargin)$);
      \draw [line width=\@crono@framelinewidth,cronolightgrey]
      ($(current page.south west)+(\@crono@frameoffset,\@crono@framemargin+\@crono@framelinesep)$)
      -- ($(current page.south east)+(-\@crono@frameoffset,\@crono@framemargin+\@crono@framelinesep)$);
      \end{tikzpicture}
    \fi%
  }
\fi


% if sphinx is not used, format headings etc
\if@crono@sphinx
  \newcommand{\cronotitle}{\@title\sphinxheadercomma\py@release}
\else
  \newcommand{\cronotitle}{\@title}
\fi

\fancypagestyle{normal}{
  \fancyhf{}
  \fancyfoot[R]{{\color{cronogrey}}}
  \fancyfoot[L]{{\color{cronogrey}\llap{\hfill\bfseries\thepage\hspace*{10pt}}\href{https://www.cronologic.de}{\footnotesize\textbf{cronologic} GmbH \& Co. KG}}}
  \fancyfoot[R]{{\footnotesize\color{cronogrey}\cronotitle}}
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}
}
\pagestyle{normal}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% hyperref package should be included last
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage{hyperref}
\hypersetup{
  colorlinks=true,
  linkcolor=cronoblue,
  urlcolor=cronogrey,
  }
\urlstyle{same}

% set pdf attributes
\AtBeginDocument{
  \hypersetup{
    pdfauthor   = {\@author},
    pdftitle    = {\@title},
    pdfkeywords = {\@crono@keywords},
    pdfsubject  = {\@crono@subject},
    pdflang     = {\@crono@language},
  }
}